# 场景定义 - 游戏的主要场景和选择
locations:
  # 洞穴入口场景
  cave_entrance:
    description: "你站在洞穴入口，里面漆黑一片但隐约传来水滴声。入口处散落着一些碎石。"
    choices:
      - text: "进入洞穴"      # 选择文本
        next: "main_chamber"  # 下一个场景
      - text: "捡起地上的石头看看"
        next: "examine_rocks"  # 检查石头场景
      - text: "离开洞穴"
        next: "exit_game"      # 退出游戏

  # 检查石头场景
  examine_rocks:
    description: "你捡起一块石头，发现它其实是把生锈的剑！这可能是某个冒险者的遗物。"
    choices:
      - text: "拿起剑"
        next: "cave_entrance"  # 返回入口
        commands:              # 执行命令
          - add_item: "rusty_sword"  # 添加物品到背包
          - add_flag: "has_sword"    # 设置标志
          - show_message: "你获得了生锈的剑！"  # 显示消息
      - text: "扔掉剑"
        next: "cave_entrance"  # 返回入口

  # 主房间场景
  main_chamber:
    description: "你进入了一个宽敞的洞穴主室。房间中央有一个古老的宝箱，角落里似乎有什么东西在动。深处似乎还有一条通道。"
    choices:
      - text: "走向宝箱"
        next: "treasure_approach"  # 接近宝箱
      - text: "调查角落的动静"
        next: "goblin_encounter"   # 遇到哥布林
      - text: "深入洞穴"
        next: "orc_encounter"      # 遇到兽人
      - text: "离开房间"
        next: "cave_entrance"      # 返回入口

  # 宝箱接近场景
  treasure_approach:
    description: "你走近宝箱，发现它上了锁。宝箱表面布满灰尘，看起来很古老。"
    choices:
      - text: "尝试打开宝箱"
        next: "treasure_locked"     # 宝箱上锁
        condition: "not has_flag('has_sword')"  # 条件：没有剑
      - text: "用剑撬开宝箱"
        next: "treasure_opened"     # 宝箱打开
        condition: "has_flag('has_sword')"      # 条件：有剑
        commands:
          - apply_effect: "strength_buff"  # 应用力量增益
          - show_message: "你用力撬开了宝箱！"  # 显示消息
      - text: "返回主室"
        next: "main_chamber"        # 返回主室

  # 宝箱上锁场景
  treasure_locked:
    description: "宝箱紧紧地锁着，你没有工具可以打开它。"
    choices:
      - text: "返回主室"
        next: "main_chamber"  # 返回主室

  # 宝箱打开场景
  treasure_opened:
    description: "宝箱打开了！里面有闪闪发光的金币和一瓶红色的药水。"
    choices:
      - text: "拿走所有物品"
        next: "victory"  # 胜利场景
        commands:
          - add_item: "gold"          # 添加金币
          - add_item: "health_potion" # 添加药水
          - set_variable: {key: "score", value: 100}  # 设置分数
          - show_message: "你找到了宝藏！"  # 显示消息
      - text: "只拿金币"
        next: "victory"  # 胜利场景
        commands:
          - add_item: "gold"  # 添加金币
          - set_variable: {key: "score", value: 50}  # 设置分数

  # 哥布林遭遇场景
  goblin_encounter:
    description: "角落里的动静原来是一个丑陋的哥布林！它发现了你，举起武器准备战斗。"
    choices:
      - text: "攻击哥布林"
        next: "combat_start"  # 开始战斗
        condition: "has_flag('has_sword')"  # 条件：有剑
      - text: "逃跑"
        next: "main_chamber"  # 返回主室
        commands:
          - show_message: "你成功逃脱了哥布林的追击。"  # 显示消息
      - text: "试图和哥布林对话"
        next: "goblin_talk"  # 对话场景

  # 哥布林对话场景
  goblin_talk:
    description: "哥布林用奇怪的语言对你吼叫，似乎不打算和你交流。它看起来很生气。"
    choices:
      - text: "攻击它"
        next: "combat_start"  # 开始战斗
      - text: "逃跑"
        next: "main_chamber"  # 返回主室

  # 战斗开始场景
  combat_start:
    description: "战斗开始了！你和哥布林互相攻击。"
    choices:
      - text: "继续战斗"
        next: "combat_result"  # 战斗结果
        commands:
          - roll_dice: {table: "goblin_loot", result_var: "combat_loot"}  # 随机掉落
          - show_message: "你击败了哥布林！"  # 显示消息
      - text: "逃跑"
        next: "main_chamber"  # 返回主室
        commands:
          - apply_effect: "poison"  # 应用中毒效果
          - show_message: "你在逃跑时被哥布林抓伤了。"  # 显示消息

  # 战斗结果场景
  combat_result:
    description: "哥布林倒下了。从它的尸体上，你找到了一些战利品。"
    choices:
      - text: "拿走战利品"
        next: "main_chamber"  # 返回主室
        commands:
          - add_item: "{combat_loot}"  # 添加随机战利品
          - set_variable: {key: "score", value: 50}  # 设置分数
      - text: "离开尸体"
        next: "main_chamber"  # 返回主室

  # 兽人遭遇场景
  orc_encounter:
    description: "你深入洞穴，发现了一个强壮的兽人守卫着一条隐秘的通道。它看起来很危险。"
    choices:
      - text: "攻击兽人"
        next: "orc_combat"  # 兽人战斗
        condition: "has_flag('has_sword')"  # 条件：有剑
      - text: "试图绕过兽人"
        next: "secret_room"  # 秘密房间
        condition: "has_flag('has_key')"  # 条件：有钥匙
        commands:
          - show_message: "你用钥匙悄悄打开了秘密房间的门。"  # 显示消息
      - text: "逃跑"
        next: "main_chamber"  # 返回主室
        commands:
          - show_message: "你迅速逃回了主室。"  # 显示消息

  # 兽人战斗场景
  orc_combat:
    description: "战斗开始了！兽人挥舞着巨大的斧头向你冲来。"
    choices:
      - text: "继续战斗"
        next: "orc_combat_result"  # 战斗结果
        commands:
          - roll_dice: {table: "orc_loot", result_var: "orc_loot"}  # 随机掉落
          - show_message: "你击败了兽人！"  # 显示消息
      - text: "逃跑"
        next: "main_chamber"  # 返回主室
        commands:
          - apply_effect: "poison"  # 应用中毒效果
          - show_message: "你在逃跑时被兽人砍伤了。"  # 显示消息

  # 兽人战斗结果场景
  orc_combat_result:
    description: "兽人倒下了。从它的尸体上，你找到了一些战利品。"
    choices:
      - text: "拿走战利品"
        next: "main_chamber"  # 返回主室
        commands:
          - add_item: "{orc_loot}"  # 添加随机战利品
          - set_variable: {key: "score", value: 100}  # 设置分数
      - text: "离开尸体"
        next: "main_chamber"  # 返回主室

  # 秘密房间场景
  secret_room:
    description: "你进入了一个隐藏的房间。房间中央有一个古老的祭坛，上面放着闪耀的魔法水晶。"
    choices:
      - text: "拿走魔法水晶"
        next: "secret_room_taken"  # 拿走水晶
        commands:
          - add_item: "magic_crystal"  # 添加魔法水晶
          - set_variable: {key: "score", value: 150}  # 设置分数
          - show_message: "你获得了魔法水晶！"  # 显示消息
      - text: "离开房间"
        next: "main_chamber"  # 返回主室

  # 秘密房间拿走水晶场景
  secret_room_taken:
    description: "你拿走了魔法水晶。房间里似乎还有其他东西，但你决定离开。"
    choices:
      - text: "返回主室"
        next: "main_chamber"  # 返回主室

  # 胜利场景
  victory:
    description: "恭喜！你成功完成了洞穴冒险。你找到了宝藏并安全返回。"
    choices:
      - text: "结束游戏"
        next: "exit_game"  # 退出游戏

  # 退出游戏场景
  exit_game:
    description: "游戏结束。感谢游玩！"
    choices: []  # 没有选择，游戏结束