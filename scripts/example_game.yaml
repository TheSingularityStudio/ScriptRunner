# ScriptRunner 示例游戏：洞穴冒险
# 这个示例展示了DSL格式的主要功能，包括对象定义、命令解析、效果系统等
# 游戏背景：玩家进入一个神秘洞穴，寻找宝藏并对抗怪物

# 游戏基本信息
game:
  title: "洞穴冒险"  # 游戏标题
  version: "1.0"     # 版本号
  author: "ScriptRunner示例"  # 作者
  description: "一个简单的文字冒险游戏示例"  # 游戏描述

# 世界设置
world:
  start: "cave_entrance"  # 起始场景ID
  description: "一个充满危险和宝藏的古老洞穴"  # 世界描述

# 对象定义 - 定义游戏中的物品、NPC、容器等
define_object:
  # 武器对象
  rusty_sword:
    type: "weapon"        # 对象类型
    name: "生锈的剑"       # 显示名称
    damage: 8            # 伤害值
    description: "一把生锈但仍然锋利的剑"  # 描述
    aliases: ["剑", "铁剑"]  # 别名，用于命令解析

  # 敌人对象
  goblin:
    type: "enemy"        # 敌人类型
    name: "哥布林"       # 名称
    health: 20          # 生命值
    damage: 5           # 攻击力
    loot_table: "goblin_loot"  # 掉落表
    description: "一个丑陋的绿色哥布林"  # 描述

  # 容器对象
  treasure_chest:
    type: "container"    # 容器类型
    name: "宝箱"         # 名称
    locked: true        # 是否上锁
    contents: ["gold", "health_potion"]  # 内容物
    description: "一个古老的木制宝箱"  # 描述

  # 物品对象
  gold:
    type: "item"         # 物品类型
    name: "金币"         # 名称
    value: 50           # 价值
    description: "闪闪发光的金币"  # 描述

  health_potion:
    type: "item"         # 物品类型
    name: "治疗药水"     # 名称
    healing: 20         # 治疗量
    description: "红色的治疗药水，可以恢复生命值"  # 描述

# 命令解析器 - 定义如何解析玩家的自然语言输入
command_parser:
  verbs:
    # 拿取命令
    take:
      patterns: ["拿", "拿起", "取", "捡起"]  # 中文模式
      aliases: ["get", "pick"]               # 英文别名

    # 使用命令
    use:
      patterns: ["使用", "用", "喝"]  # 中文模式
      aliases: ["utilize"]           # 英文别名

    # 攻击命令
    attack:
      patterns: ["攻击", "打", "杀", "砍"]  # 中文模式
      aliases: ["fight", "hit"]            # 英文别名

    # 查看命令
    look:
      patterns: ["看", "查看", "观察", "检查"]  # 中文模式
      aliases: ["examine", "inspect"]          # 英文别名

    # 打开命令
    open:
      patterns: ["打开", "开"]  # 中文模式
      aliases: ["unlock"]       # 英文别名

  nouns:
    # 代词
    pronouns:
      它: "last_object"      # 指代上一个对象
      他: "last_character"   # 指代上一个角色
      她: "last_character"   # 指代上一个角色

    # 对象别名
    objects:
      剑: "rusty_sword"      # 剑的别名
      宝箱: "treasure_chest"  # 宝箱的别名
      哥布林: "goblin"       # 哥布林的别名
      金币: "gold"           # 金币的别名
      药水: "health_potion"  # 药水的别名

# 效果系统 - 定义游戏中的各种效果
effects:
  # 力量增益效果
  strength_buff:
    type: "temporary"     # 临时效果
    duration: 3          # 持续3回合
    modifiers:
      damage: +3         # 增加3点伤害
    description: "剑术增强，增加攻击力"  # 描述

  # 中毒效果
  poison:
    type: "temporary"     # 临时效果
    duration: 5          # 持续5回合
    damage_per_turn: 2   # 每回合2点伤害
    description: "中毒状态，每回合受到伤害"  # 描述

  # 治疗效果
  healing:
    type: "instant"       # 即时效果
    healing: 20          # 恢复20点生命
    description: "恢复生命值"  # 描述

# 随机系统 - 定义随机事件和掉落
random_system:
  tables:
    # 哥布林掉落表
    goblin_loot:
      - item: "gold"           # 掉落金币
        weight: 70            # 权重70%
        count: [1, 3]         # 数量1-3个
      - item: "health_potion"  # 掉落药水
        weight: 30            # 权重30%
        count: 1              # 数量1个

# 场景定义 - 游戏的主要场景和选择
locations:
  # 洞穴入口场景
  cave_entrance:
    description: "你站在洞穴入口，里面漆黑一片但隐约传来水滴声。入口处散落着一些碎石。"
    choices:
      - text: "进入洞穴"      # 选择文本
        next: "main_chamber"  # 下一个场景
      - text: "捡起地上的石头看看"
        next: "examine_rocks"  # 检查石头场景
      - text: "离开洞穴"
        next: "exit_game"      # 退出游戏

  # 检查石头场景
  examine_rocks:
    description: "你捡起一块石头，发现它其实是把生锈的剑！这可能是某个冒险者的遗物。"
    choices:
      - text: "拿起剑"
        next: "cave_entrance"  # 返回入口
        commands:              # 执行命令
          - add_item: "rusty_sword"  # 添加物品到背包
          - add_flag: "has_sword"    # 设置标志
          - show_message: "你获得了生锈的剑！"  # 显示消息
      - text: "扔掉剑"
        next: "cave_entrance"  # 返回入口

  # 主房间场景
  main_chamber:
    description: "你进入了一个宽敞的洞穴主室。房间中央有一个古老的宝箱，角落里似乎有什么东西在动。"
    choices:
      - text: "走向宝箱"
        next: "treasure_approach"  # 接近宝箱
      - text: "调查角落的动静"
        next: "goblin_encounter"   # 遇到哥布林
      - text: "离开房间"
        next: "cave_entrance"      # 返回入口

  # 宝箱接近场景
  treasure_approach:
    description: "你走近宝箱，发现它上了锁。宝箱表面布满灰尘，看起来很古老。"
    choices:
      - text: "尝试打开宝箱"
        next: "treasure_locked"     # 宝箱上锁
        condition: "not has_flag('has_sword')"  # 条件：没有剑
      - text: "用剑撬开宝箱"
        next: "treasure_opened"     # 宝箱打开
        condition: "has_flag('has_sword')"      # 条件：有剑
        commands:
          - apply_effect: "strength_buff"  # 应用力量增益
          - show_message: "你用力撬开了宝箱！"  # 显示消息
      - text: "返回主室"
        next: "main_chamber"        # 返回主室

  # 宝箱上锁场景
  treasure_locked:
    description: "宝箱紧紧地锁着，你没有工具可以打开它。"
    choices:
      - text: "返回主室"
        next: "main_chamber"  # 返回主室

  # 宝箱打开场景
  treasure_opened:
    description: "宝箱打开了！里面有闪闪发光的金币和一瓶红色的药水。"
    choices:
      - text: "拿走所有物品"
        next: "victory"  # 胜利场景
        commands:
          - add_item: "gold"          # 添加金币
          - add_item: "health_potion" # 添加药水
          - set_variable: {key: "score", value: 100}  # 设置分数
          - show_message: "你找到了宝藏！"  # 显示消息
      - text: "只拿金币"
        next: "victory"  # 胜利场景
        commands:
          - add_item: "gold"  # 添加金币
          - set_variable: {key: "score", value: 50}  # 设置分数

  # 哥布林遭遇场景
  goblin_encounter:
    description: "角落里的动静原来是一个丑陋的哥布林！它发现了你，举起武器准备战斗。"
    choices:
      - text: "攻击哥布林"
        next: "combat_start"  # 开始战斗
        condition: "has_flag('has_sword')"  # 条件：有剑
      - text: "逃跑"
        next: "main_chamber"  # 返回主室
        commands:
          - show_message: "你成功逃脱了哥布林的追击。"  # 显示消息
      - text: "试图和哥布林对话"
        next: "goblin_talk"  # 对话场景

  # 哥布林对话场景
  goblin_talk:
    description: "哥布林用奇怪的语言对你吼叫，似乎不打算和你交流。它看起来很生气。"
    choices:
      - text: "攻击它"
        next: "combat_start"  # 开始战斗
      - text: "逃跑"
        next: "main_chamber"  # 返回主室

  # 战斗开始场景
  combat_start:
    description: "战斗开始了！你和哥布林互相攻击。"
    choices:
      - text: "继续战斗"
        next: "combat_result"  # 战斗结果
        commands:
          - roll_dice: {table: "goblin_loot", result_var: "combat_loot"}  # 随机掉落
          - show_message: "你击败了哥布林！"  # 显示消息
      - text: "逃跑"
        next: "main_chamber"  # 返回主室
        commands:
          - apply_effect: "poison"  # 应用中毒效果
          - show_message: "你在逃跑时被哥布林抓伤了。"  # 显示消息

  # 战斗结果场景
  combat_result:
    description: "哥布林倒下了。从它的尸体上，你找到了一些战利品。"
    choices:
      - text: "拿走战利品"
        next: "main_chamber"  # 返回主室
        commands:
          - add_item: "{combat_loot}"  # 添加随机战利品
          - set_variable: {key: "score", value: 50}  # 设置分数
      - text: "离开尸体"
        next: "main_chamber"  # 返回主室

  # 胜利场景
  victory:
    description: "恭喜！你成功完成了洞穴冒险。你找到了宝藏并安全返回。"
    choices:
      - text: "结束游戏"
        next: "exit_game"  # 退出游戏

  # 退出游戏场景
  exit_game:
    description: "游戏结束。感谢游玩！"
    choices: []  # 没有选择，游戏结束

# 元数据 - 游戏的额外信息
meta:
  version: "1.0"
  author: "ScriptRunner示例"
  description: "洞穴冒险游戏示例，展示了DSL的主要功能"
  tags: ["冒险", "战斗", "探索", "示例"]
  difficulty: "简单"
  estimated_time: "10分钟"
